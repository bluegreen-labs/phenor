<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>An R phenology modelling framework • phenor</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="An R phenology modelling framework">
<meta property="og:description" content="Provides an R phenology modelling framework.">
<meta property="og:image" content="/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">phenor</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/bluegreen-labs/phenor">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
<div id="phenor" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#phenor" class="anchor"></a>phenor <img src="reference/figures/logo.png" align="right" height="138.5">
</h1></div>

<p>The phenor R package is a phenology modelling framework in R. The framework leverages measurements of vegetation phenology from four common phenology observation datasets combined with (global) retrospective and projected climate data (see below).</p>
<p>The package curently focusses on North America and Europe and relies heavily on <a href="https://daymet.ornl.gov/">Daymet</a> and <a href="http://www.ecad.eu/download/ensembles/download.php">E-OBS climate data</a> for underlying climate driver data in model optimization. The package supports global gridded CMIP5 forecasts for RCP4.5 and RCP8.5 climate change scenarios using the <a href="https://nex.nasa.gov/nex/projects/1356/">NASA Earth Exchange global downscaled daily projections</a>.</p>
<p>Phenological model calibration / validation data are derived from:</p>
<ul>
<li>the transition dates derived from <a href="https://phenocam.sr.unh.edu">PhenoCam</a> time series through the <a href="https://github.com/bluegreen-labs/phenocamr">phenocamr</a> R package</li>
<li>the MODIS MCD12Q2 phenology product using the <a href="http://onlinelibrary.wiley.com/doi/10.1002/ece3.1273/full">MODISTools R package</a>
</li>
<li>the <a href="http://www.pep725.eu/">Pan European Phenology Project (PEP725)</a>
</li>
<li>the <a href="https://www.usanpn.org/">USA National Phenological Network (USA-NPN)</a>
</li>
<li>custom CSV based datasets</li>
</ul>
<p>We refer to <a href="http://onlinelibrary.wiley.com/doi/10.1111/2041-210X.12970/full">Hufkens et al. (2018)</a> for an in depth description and worked example of the phenor R package. All code used to generate the referenced publication is provided in a <a href="https://github.com/bluegreen-labs/phenor_manuscript">separate github repository</a>. Please refer to this paper when using the package for modelling efforts.</p>
<p>Keep in mind that some of the scripts will take a significant amount of time to finish. As such, some data generated for the manuscript is included in the <a href="https://github.com/bluegreen-labs/phenor_manuscript">manuscript repository</a>. Some scripts generate figures and summary statistics on precompiled datasets rather than clean runs, when available. Furthermore, due to licensing issues no PEP725 data is included and some scripts will require proper login credentials for dependent code to function properly. Similarly, a download routine is not provided for the E-OBS data as to adhere to their data sharing policy and their request to register before downloading data.</p>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode diff"><code class="sourceCode diff"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="st">- for the original package as described in the paper use release v1.0.</span></a></code></pre></div>
<p>To install the toolbox in R run the following commands in a R terminal</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="cf">if</span>(<span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span>(devtools)){<span class="kw"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span>(devtools)}</a>
<a class="sourceLine" id="cb2-2" data-line-number="2">devtools<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/devtools/man/remote-reexports.html">install_github</a></span>(<span class="st">"bluegreen-labs/phenor"</span>)</a>
<a class="sourceLine" id="cb2-3" data-line-number="3"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(phenor)</a></code></pre></div>
<p>Download a limited subset of the data described in Richardson et al. (2017) from github or clone the repository:</p>
<pre><code>git clone https://github.com/bluegreen-labs/phenocam_dataset.git</code></pre>
<p>or download the full dataset from the <a href="https://daac.ornl.gov/cgi-bin/dsviewer.pl?ds_id=1511">ORNL DAAC</a>.</p>
</div>
<div id="use" class="section level2">
<h2 class="hasAnchor">
<a href="#use" class="anchor"></a>Use</h2>
<p>Example code below shows that in few lines a modelling exercise can be set up. You can either download your own data using the phenocamr package and format them correctly using <strong>format_phenocam()</strong></p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="co"># The command below downloads all time series for deciduous broadleaf</span></a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="co"># data at the bartlett PhenoCam site and estimates the</span></a>
<a class="sourceLine" id="cb4-3" data-line-number="3"><span class="co"># phenophases.</span></a>
<a class="sourceLine" id="cb4-4" data-line-number="4"><span class="kw">pr_dl_phenocam</span>(<span class="dt">vegetation =</span> <span class="st">"DB"</span>,</a>
<a class="sourceLine" id="cb4-5" data-line-number="5">                  <span class="dt">site =</span> <span class="st">"bartlett"</span>,</a>
<a class="sourceLine" id="cb4-6" data-line-number="6">                  <span class="dt">phenophase =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb4-7" data-line-number="7"></a>
<a class="sourceLine" id="cb4-8" data-line-number="8"><span class="co"># process phenocam transition files into a consistent format</span></a>
<a class="sourceLine" id="cb4-9" data-line-number="9">phenocam_data &lt;-<span class="st"> </span><span class="kw"><a href="reference/pr_fm_phenocam.html">pr_fm_phenocam</a></span>(<span class="st">"/foo/bar/transition_dates/"</span>)</a></code></pre></div>
<p>Alternatively you can use the included data which consists of 370 site years of deciduous broadleaf forest sites as included in PhenoCam 1.0 dataset (Richardson et al. 2017) precompiled with Daymet climate variables. The file is loaded using a standard <strong>data()</strong> call or reference them directly (e.g. <em>phenocam_DB</em>).</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="co"># load the included data using</span></a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"phenocam_DB"</span>)</a></code></pre></div>
<div id="model-development-and-parameter-estimation" class="section level3">
<h3 class="hasAnchor">
<a href="#model-development-and-parameter-estimation" class="anchor"></a>Model development, and parameter estimation</h3>
<p>The gathered data can now be used in model calibration / validation. Currently 17 models as described by Basler (2016) are provided in the pacakge. These models include: null, LIN, TT, TTs, PTT, PTTs, M1, M1s, PA, Pab, SM1, SM1b, SQ, SQb, UN, UM1, PM1 and PM1b models as described in Basler (2016). In addition three spring grassland (pollen) phenology models: GR, SGSI and AGSI are included as described in Garcia-Mozo et al. 2009 and Xin et al. 2015. Finally, one autumn chilling degree day model (CDD, Jeong et al. 2012) is provided. Parameter values associated with the models are provided in a separate file included in the package but can be specified separately for model development.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="co"># comma separated parameter file inlcuded in the package</span></a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="co"># for all the included models, this file is used by default</span></a>
<a class="sourceLine" id="cb6-3" data-line-number="3"><span class="co"># in all optimization routines</span></a>
<a class="sourceLine" id="cb6-4" data-line-number="4">path &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span>(<span class="st">"%s/extdata/parameter_ranges.csv"</span>,<span class="kw"><a href="https://rdrr.io/r/base/find.package.html">path.package</a></span>(<span class="st">"phenor"</span>))</a>
<a class="sourceLine" id="cb6-5" data-line-number="5">par_ranges &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/utils/read.table.html">read.table</a></span>(path,</a>
<a class="sourceLine" id="cb6-6" data-line-number="6">                        <span class="dt">header =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb6-7" data-line-number="7">                        <span class="dt">sep =</span> <span class="st">","</span>)</a></code></pre></div>
<p>Your own model development can be done by creating similar functions which take in the described data format and parameters. Below is the function to optimize the model parameters for the <em>TT</em> (thermal time) model using Generalized Simulated Annealing (GenSA). Uppper and lower constraints to the parameter space have to be provided, and in case of GenSA initial parameters are estimated when par = NULL.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="co"># optimize model parameters</span></a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="dv">1234</span>)</a>
<a class="sourceLine" id="cb7-3" data-line-number="3">optim.par &lt;-<span class="st"> </span><span class="kw"><a href="reference/pr_fit_parameters.html">pr_fit_parameters</a></span>(<span class="dt">par =</span> <span class="ot">NULL</span>,</a>
<a class="sourceLine" id="cb7-4" data-line-number="4">                          <span class="dt">data =</span> phenocam_data,</a>
<a class="sourceLine" id="cb7-5" data-line-number="5">                          <span class="dt">cost =</span> rmse,</a>
<a class="sourceLine" id="cb7-6" data-line-number="6">                          <span class="dt">model =</span> <span class="st">"TT"</span>,</a>
<a class="sourceLine" id="cb7-7" data-line-number="7">                          <span class="dt">method =</span> <span class="st">"GenSA"</span>,</a>
<a class="sourceLine" id="cb7-8" data-line-number="8">                          <span class="dt">lower =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">1</span>,<span class="op">-</span><span class="dv">5</span>,<span class="dv">0</span>),</a>
<a class="sourceLine" id="cb7-9" data-line-number="9">                          <span class="dt">upper =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">365</span>,<span class="dv">10</span>,<span class="dv">2000</span>))</a></code></pre></div>
<p>After a few minutes optimal parameters are provided. We can use these now to calculate our model values and some accuracy metrics.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="co"># now run the model for all data in the nested list using the estimated parameters</span></a>
<a class="sourceLine" id="cb8-2" data-line-number="2">modelled &lt;-<span class="st"> </span><span class="kw"><a href="reference/pr_predict.html">pr_predict</a></span>(<span class="dt">data =</span> data, <span class="dt">par =</span> optim.par<span class="op">$</span>par)</a></code></pre></div>
<p>Easy model calibration / validation can be achieved using the <strong>model_calibration()</strong> and <strong>model_comparison()</strong> functions. Which either allow for quick screening for model development, or the comparison of a suite of models (using different starting parameters). I hope this gets you started.</p>
</div>
<div id="model-projections-and-spatial-data" class="section level3">
<h3 class="hasAnchor">
<a href="#model-projections-and-spatial-data" class="anchor"></a>Model projections and spatial data</h3>
<p>The package allows you to download gridded CMIP5 forecast data from the NASA Earth Exchange global daily downscaled climate projections project. Hindcast data are provided for global NASA Earth Exchange, Berkeley Earth, E-OBS and gridded Daymet data (at 1/4<sup>th</sup> degree, 1 degree, 1/4<sup>th</sup> degree, 1km resolutions respectively).</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="co"># running data on spatial data (determined by the class assigned by</span></a>
<a class="sourceLine" id="cb9-2" data-line-number="2"><span class="co"># various format_*() routines) will return a spatial object (raster map)</span></a>
<a class="sourceLine" id="cb9-3" data-line-number="3">map &lt;-<span class="st"> </span><span class="kw"><a href="reference/pr_predict.html">pr_predict</a></span>(<span class="dt">data =</span> spatial_data, <span class="dt">par =</span> optim.par<span class="op">$</span>par)</a></code></pre></div>
<p>An example of NASA Earth Exchange CMIP5 output and gridded Daymet data is provided below.</p>
<p><img src="https://raw.githubusercontent.com/bluegreen-labs/phenor_manuscript/master/output/Figure_5_spatial_runs.png"><em>Overview map comparing various spatial outputs of the Thermal Time (TT) and Accumulated Growing Season Index (AGSI) model optimized to deciduous broadleaf and grassland PhenoCam data respectively. a) phenor model output of the difference in estimates of spring phenology between the year 2100 and 2011 for 1/4th degree NASA Earth Exchange (NEX) global gridded Coupled Model Intercomparison Project 5 (CMIP5) Mid-Resolution Institut Pierre Simon Laplace Climate Model 5 (IPSL-CM5A-MR) model runs using the TT model parameterized on deciduous forest PhenoCam sites. Only pixels with more than 50% deciduous broadleaf or mixed forest cover per 1/4th degree pixel, using MODIS MCD12Q1 land cover data, are shown; b) phenor model output of the difference in estimates of spring phenology between the year 2100 and 2011 for NEX CMIP5 IPSL-CM5A-MR model runs using the AGSI model parameterized on grassland PhenoCam sites. Only pixels with more than 50% grassland coverage per 1/4th degree pixel, using MODIS MCD12Q1 land cover data, are shown; c) phenor model output for 11 Daymet gridded datasets (tiles) for the year 2011.</em></p>
</div>
</div>
<div id="references" class="section level2">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h2>
<p>Hufkens K., Basler J. D., Milliman T. Melaas E., Richardson A.D. 2018 <a href="http://onlinelibrary.wiley.com/doi/10.1111/2041-210X.12970/full">An integrated phenology modelling framework in R: Phenology modelling with phenor. Methods in Ecology &amp; Evolution</a>, 9: 1-10.</p>
<p>Richardson, A.D., Hufkens, K., Milliman, T., Aubrecht, D.M., Chen, M., Gray, J.M., Johnston, M.R., Keenan, T.F., Klosterman, S.T., Kosmala, M., Melaas, E.K., Friedl, M.A., Frolking, S. 2018. <a href="https://www.nature.com/articles/sdata201828">Tracking vegetation phenology across diverse North American biomes using PhenoCam imagery</a>. Scientific Data, 5, 180028.</p>
</div>
<div id="acknowledgements" class="section level2">
<h2 class="hasAnchor">
<a href="#acknowledgements" class="anchor"></a>Acknowledgements</h2>
<p>This project was is supported by the National Science Foundation’s Macro-system Biology Program (awards EF-1065029 and EF-1702697) and the Marie Skłodowska-Curie Action (H2020 grant 797668). Logo design elements are taken from the FontAwesome library according to <a href="https://fontawesome.com/license">these terms</a>.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <div class="links">
<h2>Links</h2>
<ul class="list-unstyled">
<li>Browse source code at <br><a href="https://github.com/bluegreen-labs/phenor">https://​github.com/​bluegreen-labs/​phenor</a>
</li>
<li>Report a bug at <br><a href="https://github.com/bluegreen-labs/phenor/issues">https://​github.com/​bluegreen-labs/​phenor/​issues</a>
</li>
</ul>
</div>
<div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li><a href="https://www.r-project.org/Licenses/AGPL-3">AGPL-3</a></li>
</ul>
</div>
<div class="citation">
<h2>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html">Citing phenor</a></li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Koen Hufkens <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0002-5070-8109" target="orcid.widget"><img src="https://members.orcid.org/sites/default/files/vector_iD_icon.svg" class="orcid" alt="ORCID"></a> </li>
</ul>
</div>

  <div class="dev-status">
<h2>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://travis-ci.org/bluegreen-labs/phenor"><img src="https://travis-ci.org/bluegreen-labs/phenor.svg?branch=master" alt="Build Status"></a></li>
<li><a href="https://codecov.io/gh/bluegreen-labs/phenor"><img src="https://codecov.io/gh/bluegreen-labs/phenor/branch/master/graph/badge.svg" alt="codecov"></a></li>
</ul>
</div>
</div>
</div>


      <footer><div class="copyright">
  <p>Developed by Koen Hufkens.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
